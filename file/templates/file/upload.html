<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Upload</title>
</head>
<title>File Upload</title>
<style>
    body {
        background-color: whitesmoke;
        background-image: url("https://www.transparenttextures.com/patterns/lyonnette.png");
        border-bottom: 0 solid black;
        height: 450px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #FileUpload {
        display: flex;
        justify-content: center;
    }

    .wrapper {
        margin: 30px;
        padding: 10px;
        box-shadow: 0 19px 38px rgba(0, 0, 0, 0.30), 0 15px 12px rgba(0, 0, 0, 0.22);
        border-radius: 10px;
        background-color: white;
        width: 415px;
    }

    /* === Upload Box === */
    .upload {
        margin: 10px;
        height: 85px;
        border: 8px dashed #e6f5e9;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 5px;
    }

    .upload p {
        margin-top: 12px;
        line-height: 0;
        font-size: 22px;
        color: #6d992e;
        letter-spacing: 1.5px;
    }

    .upload__button {
        background-color: #e6f5e9;
        border-radius: 10px;
        padding: 0 8px 0 10px;
    }

    .upload__button:hover {
        cursor: pointer;
        opacity: 0.8;
    }


    #file-label {
        display: inline-block;
    }

    button[type="submit"] {
        background-color: #6d992e; /* Change the background color */
        color: white; /* Change the text color */
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin: 0 auto;
        display: block;
    }

    button[type="submit"]:hover {
        background-color: #0c3214; /* Change the background color on hover */
    }

    #file-warning {
        color: red;
        display: none;
    }

    /* === Home and Files Buttons === */
    .nav-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        align-items: center; /* Align buttons vertically in the center */
    }

    .nav-buttons button {
        width: 150px;
        background-color: #6d992e;
        color: white;
        border: none;
        padding: 12px 30px; /* Increased padding for better button size */
        border-radius: 5px;
        font-size: 18px; /* Increased font size for better readability */
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin: 0 20px; /* Adjusted margin for spacing */
        display: inline-block;
    }

    .nav-buttons button:hover {
        background-color: #0c3214; /* Change the background color on hover */
    }


    /* === Progress Bar === */
    #progress-container {
        display: none;
        align-items: center;
        width: 100%;
        background-color: #e6f5e9;
        height: 30px; /* Set the height of the progress bar */
        border-radius: 5px;
        flex-direction: column; /* Adjusted for vertical alignment */
    }

    #progress-bar {
        height: 100%;
        width: 0;
        background-color: #6d992e;
        border-radius: 5px;
        transition: width 0.3s ease;
    }

    #progress-text {
        margin-top: 5px; /* Adjusted margin for spacing */
        font-size: 14px;
        color: #6d992e;
    }
</style>
<body>
<div id="FileUpload">
    <div class="wrapper">
        <form id="upload-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="upload">
                <label for="file-input">
                    <p id="file-label">Select your file <span class="upload__button">Browse</span></p>
                </label>
                <input type="file" id="file-input" name="file" style="display: none;">
            </div>
            <button type="submit">Upload</button>
            <p id="file-warning">Please select a file to upload.</p>
        </form>
        <div class="nav-buttons" id="nav-buttons">
            <button type="button" onclick="window.location.href='/'"><i class="fas fa-home fa-xs"></i> Home</button>
            <button type="button" onclick="window.location.href='/file-list'"><i class="fas fa-file fa-xs"></i> Files</button>
        </div>
        <div id="progress-container">
            <div id="progress-bar"></div>
            <div id="progress-text">0%</div>
        </div>
    </div>
</div>
<script>
    document.getElementById('file-input').addEventListener('change', function () {
        // Show the selected file name and hide the "Select your file or Browse" text
        let fileName = this.files[0].name;
        let fileLabel = document.getElementById('file-label');
        fileLabel.innerHTML = fileName;
    });

    document.getElementById('upload-form').addEventListener('submit', function (event) {
        event.preventDefault();

        let fileInput = document.getElementById('file-input');
        let fileWarning = document.getElementById('file-warning');
        let progressContainer = document.getElementById('progress-container');
        let navButtons = document.getElementById('nav-buttons'); // Select the nav-buttons container

        if (fileInput.files.length === 0) {
            // Display a warning message if no file is selected
            fileWarning.style.display = 'block';
            return;
        }

        let formData = new FormData(this);
        let xhr = new XMLHttpRequest();

        xhr.upload.addEventListener('progress', function (e) {
            if (e.lengthComputable) {
                let percentage = Math.round((e.loaded / e.total) * 100);
                document.getElementById('progress-bar').style.width = percentage + '%';
                document.getElementById('progress-text').innerText = percentage + '%';

                // Show the progress bar container when the upload starts
                progressContainer.style.display = 'flex';

                // Hide the Home and Files buttons while uploading
                navButtons.style.display = 'none';
            }
        });

        xhr.onload = function () {
            if (xhr.status === 201) {  // Assuming you return a 201 Created status on successful upload
                window.location.href = '/upload/success/';
            }
        };

        xhr.open('POST', this.action, true);
        xhr.send(formData);

        // Show the progress bar and hide the upload button and warning
        document.getElementById('upload-form').style.display = 'none';
        document.getElementById('file-warning').style.display = 'none';
    });
</script>
</body>
</html>
